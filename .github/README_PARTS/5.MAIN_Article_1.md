<h2 align="center">
  <a href="#-содержание">⬆️ Наверх</a>
</h2>

---



---

#### Шаг 1: Установите Docker

<details> 
    <summary>⚙️ Windows </summary>

**Windows:**
1. Скачайте [Docker Desktop](https://www.docker.com/products/docker-desktop)
2. Установите и запустите
3. Убедитесь что Docker работает (иконка кита в трее)

</details>

<details> 
    <summary>⚙️ Linux (Ubuntu/Debian) </summary>

```bash
# Устанавливаем Docker
sudo apt update
sudo apt install docker.io docker-compose -y

# Добавляем пользователя в группу docker
sudo usermod -aG docker $USER

# Перезагружаемся
sudo reboot
```

**Проверка установки:**
```bash
docker --version
```
# Должно вывести: `Docker version 24.0.x, build ...`

</details>

---

#### Шаг 2: Создаём конфигурацию

Создайте папку для проекта:
```bash
mkdir ~/unreal-ddc-server
cd ~/unreal-ddc-server
```

Создайте файл `docker-compose.yml`:

```yaml
version: '3.8'

services:
  minio:
    image: minio/minio:latest
    container_name: unreal-ddc-minio
    
    # Команда запуска MinIO
    command: server /data --console-address ":9001"
    
    # Постоянное хранение данных |  
    # (./minio-data) 
    # (./) - значит что папка minio-data находится там же где и фаил docker-compose.yml 
    # (minio-data) - папка на компьюторе. можете поменять на свою.
    # (:/data) - Это папка внутри контейнера её не нужно менять и трогать.
    volumes:
      - ./minio-data:/data
    
    environment:
      # Логин для входа
      MINIO_ROOT_USER: ddc_admin
      
      # Пароль (ОБЯЗАТЕЛЬНО СМЕНИТЕ!)
      MINIO_ROOT_PASSWORD: change_me_please_123
      
      # Регион (можно оставить как есть)
      MINIO_REGION: us-east-1
    
    # Порты
    ports:
      - "9000:9000"   # API MinIO (для Unreal Engine)
      - "9001:9001"   # Веб-интерфейс
    
    # Автоперезапуск при сбоях
    restart: unless-stopped
    
    # Ограничения ресурсов (опционально)
    #deploy:
    #  resources:
    #    limits:
    #      memory: 2G      # Максимум 2GB RAM
    #    reservations:
    #      memory: 512M    # Минимум 512MB RAM
```

**Объяснение параметров:**

| Параметр | Что делает | Можно ли менять |
|:----------|:------------|:-----------------|
| `image: minio/minio:latest` | Какую версию MinIO использовать | Лучше оставить latest |
| `container_name` | Имя контейнера | Да, любое |
| `./minio-data:/data` | Где хранить файлы на диске | Да, укажите свой путь |
| `MINIO_ROOT_USER` | Логин администратора | Да, придумайте свой |
| `MINIO_ROOT_PASSWORD` | Пароль (минимум 8 символов) | **Обязательно смените!** |
| `9000:9000` | Порт для UE (HTTP API) | Можно, но лучше оставить |
| `9001:9001` | Порт веб-интерфейса | Можно изменить на другой |
| `restart: unless-stopped` | Автозапуск после перезагрузки | Оставьте как есть |

---

#### Шаг 3: Запускаем MinIO

```bash
# Находимся в папке с docker-compose.yml
cd ~/unreal-ddc-server

# Запускаем контейнер
docker-compose up -d

# Проверяем что всё работает
docker-compose ps
```

**Ожидаемый вывод:**

```sh
NAME                  STATUS              PORTS
unreal-ddc-minio      Up 10 seconds       0.0.0.0:9000->9000/tcp, 0.0.0.0:9001->9001/tcp
```

**Просмотр логов:**
```bash
# Смотрим, а что происходит у нас внутри
docker-compose logs -f minio

# Выход из логов сочитание клавиш: Ctrl+C
```

---

#### Шаг 4: Открываем веб-интерфейс

1. Откройте любой браузер
2. Перейдите по адресу: 
   - **http://localhost:9001**
   - **http://127.0.0.1:9001**
3. Введите данные:
   - **Username:** `ddc_admin` (из вашего docker-compose.yml)
   - **Password:** `change_me_please_123` (СМЕНИТЕ!)

**Если не открывается:**
- Проверьте брандмауэр (порт 9001 должен быть открыт)
- Проверьте что Docker контейнер запущен командой: 
```sh
docker-compose ps
```
откроется список контейнеров найдите контейнер под названием `unreal-ddc-minio` если изменили назание контейнра, то по вашему названию.



---

#### Шаг 5: Создаём Bucket (хранилище)

В веб-интерфейсе `MinIO`:

1. **Слева нажмите "Buckets"**
2. **Справа вверху "Create Bucket"**
3. **Введите имя:** `ue-ddc-5-7`
   - Имя должно быть **строчными буквами**
   - Можно использовать `-` но не `_`
   - Примеры: `ue-ddc-5-7`, `unreal-cache`, `team-ddc`
4. **Нажмите "Create Bucket"**

**Рекомендуемая структура Bucket-ов:**

```sh
ue-ddc-5-7-win64     ← Для Windows сборок UE 5.7
ue-ddc-5-7-linux     ← Для Linux сборок UE 5.7
ue-ddc-5-8-win64     ← Для будущей версии UE 5.8
cooked-builds        ← Для готовых сборок игры
```

**Почему отдельные bucket-ы?**
- Кеш для Windows ≠ кеш для Linux
- Разные версии UE несовместимы
- Проще управлять и очищать

---

#### Шаг 6: Создаём пользователя для UE

**Зачем отдельный пользователь?**
- Безопасность: если кто-то узнает пароль, он не сможет удалить всё
- Контроль: можно ограничить доступ только к нужным bucket-ам

**Создание пользователя:**

1. В MinIO: **Identity → Users → Create User**
2. **Access Key:** `unreal_engine` (это логин)
3. **Secret Key:** `ue_secret_key_2024` (это пароль, придумайте свой)
4. **Assign Policies:** выберите `readwrite` или создайте свою политику

**Пример политики (только для нужных bucket-ов):**

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::ue-ddc-5-7-win64/*",
        "arn:aws:s3:::ue-ddc-5-7-win64"
      ]
    }
  ]
}
```

---

### 4.4 Настройка Unreal Engine для работы с MinIO

#### Шаг 1: Находим файл конфигурации

Откройте файл:
```
<Ваш_Проект>/Config/Engine.ini
```

Если файла нет, создайте его.

---

#### Шаг 2: Добавляем конфигурацию DDC

**Базовая конфигурация:**
```ini
[DerivedDataBackendGraph]
; Локальный кеш (на вашем SSD)
Local=(Type=FileSystem, 
       Path="%ENGINEDIR%/../../DerivedDataCache", 
       WriteAccess=true, 
       MaxSize=50GB)

; Общий кеш через MinIO (S3)
Shared=(Type=S3,
        Bucket=ue-ddc-5-7-win64,
        Region=us-east-1,
        AccessKey=unreal_engine,
        SecretKey=ue_secret_key_2024,
        Endpoint=http://YOUR_SERVER_IP:9000,
        WriteAccess=true)

; Настройки кеширования
MinimumDaysToKeepFile=7
MaxFileChecksPerSec=64
```

**Замените:**
- `YOUR_SERVER_IP` — на IP адрес вашего сервера
  - Если на том же компьютере: `localhost` или `127.0.0.1`
  - Если на другом: `192.168.1.100` (узнайте в `ipconfig` / `ifconfig`)
- `AccessKey` и `SecretKey` — на ваши данные из MinIO

---

#### Продвинутая конфигурация (с оптимизацией):

```ini
[DerivedDataBackendGraph]
; Локальный SSD кеш
Local=(Type=FileSystem, 
       Path="%ENGINEDIR%/../../DerivedDataCache",
       WriteAccess=true,
       MaxSize=100GB,
       MaxFileChecksPerSec=128,
       AsyncReads=true,
       AsyncWrites=true)

; MinIO (Shared S3)
Shared=(Type=S3,
        Bucket=ue-ddc-5-7-win64,
        Region=us-east-1,
        AccessKey=unreal_engine,
        SecretKey=ue_secret_key_2024,
        Endpoint=http://YOUR_SERVER_IP:9000,
        WriteAccess=true,
        MaxConnections=16,
        MaxBackoff=8000,
        MaxRetries=5,
        Parallelism=4)

; Boot кеш (загружается при старте движка)
Boot=(Type=Boot,
      Filename="%GAMEDIR%/DerivedDataCache/Boot.ddc")

; Порядок проверки
Root=(Type=Hierarchical, 
      Inner=Boot,
      Inner=Local,
      Inner=Shared)

; Общие настройки
MinimumDaysToKeepFile=14
MaxFileChecksPerSec=256
```

**Объяснение дополнительных параметров:**

| Параметр | Что делает | Рекомендуемое значение |
|----------|------------|------------------------|
| `MaxConnections=16` | Сколько одновременных подключений к MinIO | 8-32 (больше = быстрее, но нагрузка на сеть) |
| `MaxBackoff=8000` | Максимальное время ожидания при ошибке (мс) | 5000-10000 |
| `MaxRetries=5` | Сколько раз повторить при ошибке | 3-5 |
| `Parallelism=4` | Сколько файлов качать одновременно | 2-8 |
| `Boot.ddc` | Кеш основных шейдеров (загружается сразу) | Полезно для больших проектов |

---

#### Шаг 3: Проверяем работу

**1. Запустите Unreal Engine**

**2. Откройте Output Log:**
   - Window → Developer Tools → Output Log
   - Найдите строки с `LogDerivedDataCache`

**3. Успешное подключение выглядит так:**
```
LogDerivedDataCache: Shared DDC (S3): Connected to http://192.168.1.100:9000
LogDerivedDataCache: Bucket: ue-ddc-5-7-win64
LogDerivedDataCache: Using hierarchical cache (Boot->Local->Shared)
```

**4. Ошибки подключения:**
```
LogDerivedDataCache: Warning: Failed to connect to S3 endpoint
```

**Возможные причины:**
- Неправильный IP адрес
- Порт 9000 заблокирован firewall
- Неверный AccessKey или SecretKey
- MinIO не запущен

---

#### Шаг 4: Тестируем кеширование

**Тест 1: Генерация кеша**
1. Откройте любой материал в проекте
2. В Output Log увидите:
   ```
   LogDerivedDataCache: Put: [длинный хеш] (Shared) - 1.2MB
   ```
3. Зайдите в MinIO веб-интерфейс → Buckets → ваш bucket
4. Должны появиться файлы!

**Тест 2: Получение из кеша**
1. Закройте Unreal Engine
2. Удалите локальный кеш:
   ```
   Windows: C:\Users\<User>\AppData\Local\UnrealEngine\Common\DerivedDataCache
   Linux: ~/.cache/UnrealEngine/DerivedDataCache
   ```
3. Снова откройте проект
4. В Output Log:
   ```
   LogDerivedDataCache: Get: [хеш] (Shared) - Hit! 1.2MB
   ```
   "Hit" = файл найден в общем кеше!

---

### 4.5 Доступ через интернет (опционально)

Если ваша команда работает удалённо:

#### Вариант 1: Проброс портов на роутере

1. Зайдите в настройки роутера (обычно `192.168.1.1`)
2. Найдите "Port Forwarding" или "Проброс портов"
3. Добавьте правило:
   - **External Port:** 9000
   - **Internal IP:** IP вашего сервера
   - **Internal Port:** 9000
4. Узнайте ваш внешний IP: https://whatismyipaddress.com/
5. В `Engine.ini` используйте:
   ```ini
   Endpoint=http://YOUR_EXTERNAL_IP:9000
   ```

**⚠️ Важно для безопасности:**
- Обязательно смените пароли в MinIO
- Используйте сложные пароли (20+ символов)
- Рассмотрите VPN вместо прямого доступа

---

#### Вариант 2: VPN (безопаснее)

Используйте VPN чтобы все разработчики были "в одной сети":

**Варианты VPN:**
- **WireGuard** — быстрый и современный
- **OpenVPN** — проверенный временем
- **Tailscale** — самый простой (рекомендуется для новичков)

**С Tailscale:**
1. Установите на сервер и все компьютеры
2. Все получат IP вида `100.x.x.x`
3. В `Engine.ini`:
   ```ini
   Endpoint=http://100.x.x.x:9000
   ```

---

### 4.6 Оптимизация производительности

#### Железо сервера

**Минимальные требования (2-5 человек):**
- CPU: 2 ядра
- RAM: 4GB
- Диск: HDD 500GB
- Сеть: 100 Mbps

**Рекомендуется (5-15 человек):**
- CPU: 4-8 ядер
- RAM: 8-16GB
- Диск: SSD 1TB
- Сеть: 1 Gbps

**Оптимально (15+ человек):**
- CPU: 16+ ядер
- RAM: 32GB+
- Диск: NVMe 2TB+
- Сеть: 10 Gbps

---

#### Настройки MinIO для производительности

Создайте файл `minio-config.json`:
```json
{
  "version": "36",
  "cache": {
    "drives": ["/cache"],
    "expiry": 90,
    "quota": 80
  }
}
```

Подключите в `docker-compose.yml`:
```yaml
volumes:
  - ./minio-data:/data
  - ./minio-config.json:/root/.minio/config.json
  - ./cache:/cache   # Дополнительный кеш в RAM
```

---

<h2 align="center">
  <a href="#-содержание">⬆️ Наверх</a>
</h2>